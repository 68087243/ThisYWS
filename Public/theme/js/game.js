function getallgames(){var a=[],e=$("#w-allgames li");return e.each(function(e){a[e]=[];var t=$(this).data("main"),s=t.split("|");a[e][0]=s[0],a[e][1]=s[1],a[e][2]=s[2],a[e][3]=s[3],a[e][4]=$(this).find("a").attr("href"),a[e][5]=$(this).find("a").text()}),a}function SortGame(){var a=[],e=[];if(0!=selectAry[0]){for(var t=0;allnum>t;t++){allgames[t][1]==selectAry[0]&&a.push(allgames[t])}}else{a=allgames}if(0!=selectAry[1]){for(var t=0;t<a.length;t++){-1!=selectAry[1].toString().indexOf(a[t][0])&&e.push(a[t])}a=e}if(0!=selectAry[2]){e=[];for(var t=0;t<a.length;t++){a[t][3]==selectAry[2]&&e.push(a[t])}a=e}if(searsat){var s=$("#searchTxt").val();e=[];for(var t=0;allnum>t;t++){-1!=allgames[t][5].indexOf(s)&&e.push(allgames[t])}a=e}if(tablestart=a.length!=allnum?!0:!1){e=[];for(var l=0,i="abcdefghijklmnopqrstuvwxyz".split(""),r=i.length;r>l;l++){for(var t=0;t<a.length;t++){-1!=i[l].indexOf(a[t][0])&&e.push(a[t])}}a=e}return 0==a.length?$("#w-con-none").show():$("#w-con-none").hide(),total=a.length,totalpage=Math.ceil(total/pagesize),1>totalpage&&(totalpage=1),isShowTable(),a}function jpage(a,e,t){if(!(2>a)){t||(t=4);var s=e-t,l=e+t;e>a-t&&(s=a-2*t+1),1>s&&(s=1),t>e&&(l=2*t),l>a&&(l=a);var i=[];e>1&&i.push('<a target="_self" class="page-prev-w" href="#第'+(e-1)+'页" onclick="gotopage('+(e-1)+',1);return false;"><</a>'),e-t>1&&s>1&&(i.push('<a href="#第1页" onclick="gotopage(1,1);return false;">1</a>'),s>2&&i.push("<span>...</span>"));for(var r=s;l>=r;r++){i.push(r!=e?'<a target="_self" href="#第'+r+'页" onclick="gotopage('+r+',1);return false;">'+r+"</a>":'<strong title="当前第 '+e+' 页">'+e+"</strong>")}return a>l&&(a-l>1&&i.push("<span>...</span>"),i.push('<a href="#第'+a+'页" onclick="gotopage('+a+',1);return false;">'+a+"</a>")),a>e&&i.push('<a target="_self" class="page-next-w" href="#第'+(e+1)+'页" onclick="gotopage('+(e+1)+',1);return false;">></a>'),i.join("")}}function gotopage(a,e){page=a;var t=(a-1)*pagesize,s=t+pagesize;s>total&&(s=total);for(var l=[],i=SortGame(),r=t;s>r;r++){l.push('<li><div class="w-agamescon"><a href="'+i[r][4]+'" class="w-agamescon-a"><img src="'+i[r][2]+'" alt=""></a><div class="w-jqyxb"><a href="'+i[r][4]+'" class="w-jqyxplay"><i></i>开始游戏</a><a href="'+i[r][4]+'">'+i[r][5]+'</a></div></div><i class="w-agamesbg"></i></li>')}initpage(),$("#w-allgames").html(l.join("")),e&&window.scrollTo(0,$(".w-paixu").offset().top)}function initpage(){return 2>totalpage?void $("#ztpage").hide():($("#ztpage").html(jpage(totalpage,page)).show(),void (tablestart||$("#ztpage").hide()))}var page=1,pagesize=12,total=0,totalpage=0,selectAry=[0,0,0,0,0,0,0],searsat=!1,tablestart=!1,isShowTable=function(){var a=$("#bgames");tablestart?a.addClass("hidden"):a.removeClass("hidden")},allgames=getallgames(),allnum=allgames.length;SortGame(),initpage(),gotopage(1);var hotKeyContainer=$("#class-key-w span"),initialKeyContainer=$("#initial-key-w span"),tagKeyContainer=$("#tag-key-w span");hotKeyContainer.click(function(){$(this).addClass("cur").siblings().removeClass("cur");var a=$(this).text();selectAry[0]="不限"!=a?a:0,SortGame(),initpage(),gotopage(1)}),initialKeyContainer.click(function(){$(this).addClass("cur").siblings().removeClass("cur");var a=$(this).text();selectAry[1]="不限"!=a?a.toLowerCase().split(""):0,SortGame(),initpage(),gotopage(1)}),tagKeyContainer.click(function(){$(this).addClass("cur").siblings().removeClass("cur");var a=$(this).text();selectAry[2]="不限"!=a?a:0,SortGame(),initpage(),gotopage(1)}),$("#searchG").click(function(){var a=$("#searchTxt").val();/^\s*$/.test(a)||(searsat=!0,SortGame(),initpage(),gotopage(1),searsat=!1)});$(".favg").click(function(){if(latestLimit==""){layer.alert("请登录!",{icon:2,title:"提示"});return}gameCollects($(this).attr("data-gid"))});function gameCollects(gid){$.ajax({type:"GET",url:U("Api/Game/gameCollects","gid="+gid+"&callback=?"),dataType:"jsonp",success:function(e){if(e.code==0){$(".favg").attr("title","已收藏");$(".favg").addClass("favok")}else{$(".favg").attr("title","收藏");$(".favg").removeClass("favok")}},error:function(){}})};